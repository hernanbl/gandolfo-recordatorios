{% extends 'admin/base.html' %}
{% block title %}Top Clientes{% endblock %}
{% block content %}
<div class="bg-white p-8 rounded-lg shadow-md w-full max-w-2xl mx-auto text-center mt-8">
    <h2 class="text-2xl font-bold mb-4">Top Clientes (Ãºltimos 3 meses)</h2>
    <canvas id="topClientesChart" width="400" height="200"></canvas>
    <div id="loader" class="mt-4 text-gray-600">Cargando datos...</div>
    <a href="{{ url_for('admin.dashboard') }}" class="mt-6 inline-block bg-amber-600 text-white px-4 py-2 rounded hover:bg-amber-700">Volver al Dashboard</a>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    async function cargarTopClientes() {
        const loader = document.getElementById('loader');
        try {
            const resp = await fetch('/admin/api/top-clientes');
            const data = await resp.json();
            loader.style.display = 'none';
            if (!data.success) {
                loader.textContent = data.error || 'Error al cargar datos';
                loader.style.display = 'block';
                return;
            }
            const ctx = document.getElementById('topClientesChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Reservas confirmadas',
                        data: data.counts,
                        backgroundColor: 'rgba(251, 191, 36, 0.7)',
                        borderColor: 'rgba(251, 191, 36, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        } catch (e) {
            loader.textContent = 'Error al cargar datos';
            loader.style.display = 'block';
        }
    }
    cargarTopClientes();
</script>
{% endblock %}
