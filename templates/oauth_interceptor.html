<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interceptor OAuth - Gandolfo</title>
    <script>
        console.log('üîç OAuth Interceptor cargado en:', window.location.href);
        
        // Funci√≥n para detectar si tenemos tokens OAuth v√°lidos
        function hasOAuthTokens() {
            const hash = window.location.hash;
            return hash.includes('access_token=') && hash.includes('token_type=');
        }
        
        // Funci√≥n para redirigir a la URL correcta
        function redirectToCorrectDomain() {
            const currentHost = window.location.hostname;
            const hash = window.location.hash;
            
            console.log('üåê Host actual:', currentHost);
            console.log('üîó Hash actual:', hash);
            
            // Si estamos en localhost pero deber√≠amos estar en producci√≥n
            if (currentHost === 'localhost' || currentHost === '127.0.0.1') {
                const productionUrl = `https://gandolfo.app/admin/auth/callback${hash}`;
                console.log('üöÄ Redirigiendo a producci√≥n:', productionUrl);
                
                // Mostrar mensaje antes de redirigir
                document.body.innerHTML = `
                    <div style="
                        display: flex; 
                        justify-content: center; 
                        align-items: center; 
                        height: 100vh; 
                        font-family: Arial, sans-serif;
                        background: #f8f9fa;
                    ">
                        <div style="
                            text-align: center; 
                            padding: 40px; 
                            background: white; 
                            border-radius: 12px; 
                            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
                        ">
                            <h2>üîÑ Redirigiendo a Gandolfo...</h2>
                            <p>Completando tu autenticaci√≥n con Google</p>
                            <div style="margin: 20px 0;">
                                <div style="
                                    width: 40px; 
                                    height: 40px; 
                                    border: 4px solid #f3f3f3; 
                                    border-top: 4px solid #28a745; 
                                    border-radius: 50%; 
                                    animation: spin 1s linear infinite; 
                                    margin: 0 auto;
                                "></div>
                            </div>
                        </div>
                    </div>
                    <style>
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                    </style>
                `;
                
                // Redirigir despu√©s de un breve delay para mostrar el mensaje
                setTimeout(() => {
                    window.location.href = productionUrl;
                }, 1500);
                
                return true; // Indicamos que hicimos redirect
            }
            
            return false; // No hicimos redirect
        }
        
        // Ejecutar inmediatamente al cargar la p√°gina
        if (hasOAuthTokens()) {
            console.log('‚úÖ Tokens OAuth detectados');
            
            if (!redirectToCorrectDomain()) {
                console.log('‚úÖ Ya estamos en el dominio correcto, continuando...');
                // Si ya estamos en el dominio correcto, proceder normalmente
                window.location.href = '/admin/auth/callback' + window.location.hash;
            }
        } else {
            console.log('‚ùå No se detectaron tokens OAuth v√°lidos');
            // Si no hay tokens, redirigir al login
            window.location.href = '/admin/login';
        }
    </script>
</head>
<body>
    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: Arial, sans-serif;">
        <div style="text-align: center;">
            <h2>Procesando autenticaci√≥n...</h2>
            <p>Por favor espera un momento</p>
        </div>
    </div>
</body>
</html>
